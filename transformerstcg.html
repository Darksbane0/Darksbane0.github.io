

<!DOCTYPE html>
<html lang="en" >

<head>

  <meta charset="UTF-8">
   <title>Transformers TCG</title>
   <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-bootstrap/0.5pre/assets/css/bootstrap.min.css'>
   <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css'>
   <style> 
	body {
	    background-image: url(https://transformers.hasbro.com/images/tcg/main_bg.png);
	}
	.searchresults {
		width:300px;
		max-height: 519px;
		overflow-x: hidden;
		overflow-y: scroll;		
	}
	#display {
	  display: -webkit-flex;
	  display: flex;
	}
	#searchfields{
	  margin:10px;
	}
	#cards {
	  list-style:none;
	}
	#cards li {
	  padding:5px;
	}
	.image {
	  -webkit-flex: 1; 
	  flex: 1;
	}

	.image img {
	  	max-width: 100%;
    	max-height: 519px;
	}
	#cards li {
	  border: 1px solid black;
	  border-radius: 4px;
	  margin:4px;
	  cursor:pointer;
	}
	#cards li {
    	background: whitesmoke;
	}
	#cards li:hover{
	  background:lightblue;
	}
.pip {
    display: inline-block;
    width: 44px;
    /* margin: 3px; */
    line-height: 40px;
    position: relative;
    outline: 0;
    height: 30px;
    margin-top: -7px;
	border-radius: 4px;
}
.orange {
    background-image: url(https://scontent-lga3-1.xx.fbcdn.net/v/t1.0-9/41678556_1797997690322048_501…4368354304_n.png?_nc_cat=0&oh=dbb93e3…&oe=5C5E62E6);
    background-position-x: -316px;
    background-position-y: -19px;
}
.white {
    background-image: url(https://scontent-lga3-1.xx.fbcdn.net/v/t1.0-9/41548494_1799073000214517_2856566002492112896_n.png?_nc_cat=0&oh=695a1e3be20bf4981c376082a26a7e5a&oe=5C328662);
    background-position-x: -316px;
    background-position-y: -19px;
}
.blue {
    background-image: url(https://scontent-lga3-1.xx.fbcdn.net/v/t1.0-9/41442038_1797846933670457_4689190013248733184_n.png?_nc_cat=0&oh=f62984e9523fb56fa8143d907269711c&oe=5C338C03);
    background-position-x: -316px;
    background-position-y: -19px;
}
	.SelectClass,.SumoSelect.open .search-txt,.SumoUnder
	   {position:absolute;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;top:0;left:0}
	.SumoSelect p{margin:0}
	.SumoSelect{width:200px}
	.SelectBox{padding:5px 8px}
	.sumoStopScroll{overflow:hidden}
	.SumoSelect .hidden{display:none}
	.SumoSelect .search-txt{display:none;outline:0}
	.SumoSelect .no-match{display:none;padding:6px}
	.SumoSelect.open .search-txt{display:inline-block;width:100%;margin:0;padding:5px 8px;border:none;box-sizing:border-box;border-radius:5px}
	.SumoSelect.open>.search>label,.SumoSelect.open>.search>span{visibility:hidden}
	.SelectClass,.SumoUnder{z-index:-1;right:0;height:100%;width:100%;border:none;box-sizing:border-box;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity:0;opacity:0}
	.SelectClass{z-index:1}
	.SumoSelect .select-all>label,.SumoSelect>.CaptionCont,.SumoSelect>.optWrapper>.options li.opt label{user-select:none;-o-user-select:none;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none}.SumoSelect{display:inline-block;position:relative;outline:0}.SumoSelect.open>.CaptionCont,.SumoSelect:focus>.CaptionCont,.SumoSelect:hover>.CaptionCont{box-shadow:0 0 2px #7799D0;border-color:#7799D0}.SumoSelect>.CaptionCont{position:relative;border:1px solid #A4A4A4;min-height:14px;background-color:#fff;border-radius:2px;margin:0}.SumoSelect>.CaptionCont>span{display:block;padding-right:30px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;cursor:default}.SumoSelect>.CaptionCont>span.placeholder{color:#ccc;font-style:italic}.SumoSelect>.CaptionCont>label{position:absolute;top:0;right:0;bottom:0;width:30px}.SumoSelect>.CaptionCont>label>i{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wMdBhAJ/fwnjwAAAGFJREFUKM9jYBh+gBFKuzEwMKQwMDB8xaOWlYGB4T4DA0MrsuapDAwM//HgNwwMDDbYTJuGQ8MHBgYGJ1xOYGNgYJiBpuEpAwODHSF/siDZ+ISBgcGClEDqZ2Bg8B6CkQsAPRga0cpRtDEAAAAASUVORK5CYII=);background-position:center center;width:16px;height:16px;display:block;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;background-repeat:no-repeat;opacity:.8}.SumoSelect>.optWrapper{display:none;z-index:1000;top:30px;width:100%;position:absolute;left:0;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;background:#fff;border:1px solid #ddd;box-shadow:2px 3px 3px rgba(0,0,0,.11);border-radius:3px;overflow:hidden}.SumoSelect.open>.optWrapper{top:35px;display:block}.SumoSelect.open>.optWrapper.up{top:auto;bottom:100%;margin-bottom:5px}.SumoSelect>.optWrapper ul{list-style:none;display:block;padding:0;margin:0;overflow:auto}.SumoSelect>.optWrapper>.options{border-radius:2px;position:relative;max-height:250px}.SumoSelect>.optWrapper.okCancelInMulti>.options{border-radius:2px 2px 0 0}.SumoSelect>.optWrapper.selall>.options{border-radius:0 0 2px 2px}.SumoSelect>.optWrapper.selall.okCancelInMulti>.options{border-radius:0}.SumoSelect>.optWrapper>.options li.group.disabled>label{opacity:.5}.SumoSelect>.optWrapper>.options li ul li.opt{padding-left:22px}.SumoSelect>.optWrapper.multiple>.options li ul li.opt{padding-left:50px}.SumoSelect>.optWrapper.isFloating>.options{max-height:100%;box-shadow:0 0 100px #595959}.SumoSelect>.optWrapper>.options li.opt{padding:6px;position:relative;border-bottom:1px solid #f5f5f5}.SumoSelect>.optWrapper>.options>li.opt:first-child{border-radius:2px 2px 0 0}.SumoSelect>.optWrapper.selall>.options>li.opt:first-child{border-radius:0}.SumoSelect>.optWrapper>.options>li.opt:last-child{border-radius:0 0 2px 2px;border-bottom:none}.SumoSelect>.optWrapper.okCancelInMulti>.options>li.opt:last-child{border-radius:0}.SumoSelect>.optWrapper>.options li.opt:hover{background-color:#E4E4E4}.SumoSelect .select-all.sel,.SumoSelect>.optWrapper>.options li.opt.sel{background-color:#a1c0e4}.SumoSelect>.optWrapper>.options li label{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block;cursor:pointer}.SumoSelect>.optWrapper>.options li span{display:none}.SumoSelect>.optWrapper>.options li.group>label{cursor:default;padding:8px 6px;font-weight:700}.SumoSelect>.optWrapper.isFloating{position:fixed;top:0;left:0;right:0;width:90%;bottom:0;margin:auto;max-height:90%}.SumoSelect>.optWrapper>.options li.opt.disabled{background-color:inherit;pointer-events:none}.SumoSelect>.optWrapper>.options li.opt.disabled *{-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";filter:alpha(opacity=50);-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}.SumoSelect>.optWrapper.multiple>.options li.opt{padding-left:35px;cursor:pointer}.SumoSelect .select-all>span,.SumoSelect>.optWrapper.multiple>.options li.opt span{position:absolute;display:block;width:30px;top:0;bottom:0;margin-left:-35px}.SumoSelect .select-all>span i,.SumoSelect>.optWrapper.multiple>.options li.opt span i{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;width:14px;height:14px;border:1px solid #AEAEAE;border-radius:2px;box-shadow:inset 0 1px 3px rgba(0,0,0,.15);background-color:#fff}.SumoSelect>.optWrapper>.MultiControls{display:none;border-top:1px solid #ddd;background-color:#fff;box-shadow:0 0 2px rgba(0,0,0,.13);border-radius:0 0 3px 3px}.SumoSelect>.optWrapper.multiple.isFloating>.MultiControls{display:block;margin-top:5px;position:absolute;bottom:0;width:100%}.SumoSelect>.optWrapper.multiple.okCancelInMulti>.MultiControls{display:block}.SumoSelect>.optWrapper.multiple.okCancelInMulti>.MultiControls>p{padding:6px}.SumoSelect>.optWrapper.multiple.okCancelInMulti>.MultiControls>p:focus{box-shadow:0 0 2px #a1c0e4;border-color:#a1c0e4;outline:0;background-color:#a1c0e4}.SumoSelect>.optWrapper.multiple>.MultiControls>p{display:inline-block;cursor:pointer;padding:12px;width:50%;box-sizing:border-box;text-align:center}.SumoSelect>.optWrapper.multiple>.MultiControls>p:hover{background-color:#f1f1f1}.SumoSelect>.optWrapper.multiple>.MultiControls>p.btnOk{border-right:1px solid #DBDBDB;border-radius:0 0 0 3px}.SumoSelect>.optWrapper.multiple>.MultiControls>p.btnCancel{border-radius:0 0 3px}.SumoSelect>.optWrapper.isFloating>.options li.opt{padding:12px 6px}.SumoSelect>.optWrapper.multiple.isFloating>.options li.opt{padding-left:35px}.SumoSelect>.optWrapper.multiple.isFloating{padding-bottom:43px}.SumoSelect .select-all.partial>span i,.SumoSelect .select-all.selected>span i,.SumoSelect>.optWrapper.multiple>.options li.opt.selected span i{background-color:#11a911;box-shadow:none;border-color:transparent;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAYAAAD+Bd/7AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNXG14zYAAABMSURBVAiZfc0xDkAAFIPhd2Kr1WRjcAExuIgzGUTIZ/AkImjSofnbNBAfHvzAHjOKNzhiQ42IDFXCDivaaxAJd0xYshT3QqBxqnxeHvhunpu23xnmAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-position:center center}.SumoSelect.disabled{opacity:.7;cursor:not-allowed}.SumoSelect.disabled>.CaptionCont{border-color:#ccc;box-shadow:none}.SumoSelect .select-all{border-radius:3px 3px 0 0;position:relative;border-bottom:1px solid #ddd;background-color:#fff;padding:8px 0 3px 35px;height:20px;cursor:pointer}.SumoSelect .select-all>label,.SumoSelect .select-all>span i{cursor:pointer}.SumoSelect .select-all.partial>span i{background-color:#ccc}.SumoSelect>.optWrapper>.options li.optGroup{padding-left:5px;text-decoration:underline}
	.SumoSelect input { 
	  height: inherit !important;
	}
    </style>
</head>

<body translate="no" >

  <h1>Transformers TCG</h1>
<div id="content">
  <div id="searchfields">
    Title: <input type="text" id="cardName"></input>
    Type: <select id="cardType" multiple="multiple">
    </select>
    Rarity:<select id="cardRarity" multiple="multiple">
    </select>
    SubType: <select id="cardProfession">
      <option>Any</option>
    </select>
	<div class="pip orange">&nbsp;</div>
    <select id="cardOrange" multiple="multiple">
    </select>
	<div class="pip blue">&nbsp;</div>
    <select id="cardBlue" multiple="multiple">
    </select>
	<div class="pip white">&nbsp;</div>
    <select id="cardWhite" multiple="multiple">
    </select>
    Attack: <select id="cardAttackAlt" multiple="multiple">
    </select>
    Attack: <select id="cardAttackBot" multiple="multiple">
      <optgroup label="Bot Attack"></optgroup>
    </select>
    Stars: <select id="cardStars" multiple="multiple">
    </select>
    Set: <select id="cardSet" multiple="multiple">
      
    </select>
  </div>
  <div id="display">
    <div class="searchresults">
      <ul id="cards"></ul>
    </div>
    <div class="image" id="cardDisplay"></div>
  </div>
</div>
<div id="compressed"></div>
  
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/alasql/0.4.11/alasql.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery.sumoselect/3.0.2/jquery.sumoselect.min.js'></script>

  

    <script >
$(document).ready(function(){
  alasql("CREATE TABLE cards");

  var ajaxInProgress = false,
      cards = {};
  function getData(){
    var url = "https://sheets.googleapis.com/v4/spreadsheets/1cQrKGst252GnVSMe1yMk2WK4NchLc-9TzLVTytU1oFs/values/Sheet1?key=AIzaSyBrEtIfGwvB6ok6WyZeYGAsAlWqD6cZ208"
    $.ajax({
				type: "GET",
				url: url,
				beforeSend: function ( xhr ) {
					ajaxInProgress = true;
				},
				dataType: "json"
			}).done(function( msg ) {
				//console.log(msg);
        cards = getJsonArrayFromData(msg.values);
        var fullCardName = [],
            professionList = {};
        alasql.tables.cards.data = cards;
        var res = alasql('SELECT * FROM cards order by Name');
        $.each(res, function(k,v){
          
          if (v.Title !=""){
            fullCardName.push(v.Name + " • " + v.Title);
          } else {
            fullCardName.push(v.Name);
          }
          var professions = v.Profession.split(",");
          $.each(professions, function (k,v){
            var prof = v.trim().replace(/\s|\[|\]/g,"");
            professionList[prof] = "";
          });
          
        })

        Object.keys(professionList)
        .sort()
        .forEach(function(v, i) {
            if (v!="")
               $("#cardProfession").append('<option>' + v + '</option>')
         });
        console.log(professionList); 
        $( "#cardName" ).autocomplete({
          source: fullCardName
        });
        displayQueryResults(res);
        var types = alasql('SELECT distinct(Type) FROM cards order by Type');
        $.each(types, function(k,v){
          $("#cardType").append('<option selected="selected">' + v['(Type)'] + '</option>')
        });
        var rarities = alasql('SELECT distinct(Rarity) FROM cards order by Rarity');
        $.each(rarities, function(k,v){
          $("#cardRarity").append('<option selected="selected">' + v['(Rarity)'] + '</option>')
        });
        var cardset = alasql('SELECT distinct CardSet FROM cards order by CardSet');
        $.each(cardset, function(k,v){
          $("#cardSet").append('<option selected="selected">' + v['CardSet'] + '</option>')
        });
        var cardorange = alasql('SELECT distinct Orange FROM cards order by Orange');
        $.each(cardorange, function(k,v){
          $("#cardOrange").append('<option selected="selected">' + v['Orange'] + '</option>')
        });
        var cardblue = alasql('SELECT distinct Blue FROM cards order by Blue');
        $.each(cardblue, function(k,v){
          $("#cardBlue").append('<option selected="selected">' + v['Blue'] + '</option>')
        });
        var cardWhite = alasql('SELECT distinct White FROM cards order by White');
        $.each(cardWhite, function(k,v){
          $("#cardWhite").append('<option selected="selected">' + v['White'] + '</option>')
        });
        var cardStars = alasql('SELECT distinct Stars  FROM cards order by Stars::NUMBER ');
        $.each(cardStars, function(k,v){
          $("#cardStars").append('<option selected="selected">' + v['Stars'] + '</option>')
        });
        var cardAttackBot = alasql('SELECT distinct AttackBot  FROM cards order by AttackBot::NUMBER ');
        $.each(cardAttackBot, function(k,v){
          var attackbot = v['AttackBot'];
          if (attackbot == ""){
            attackbot = "&nbsp;";
          }
          $("#cardAttackBot").append('<option selected="selected">' + attackbot + '</option>')
        });
        var cardAttackAlt = alasql('SELECT distinct AttackAlt  FROM cards order by AttackAlt::NUMBER ');
        $.each(cardAttackAlt, function(k,v){
          $("#cardAttackAlt").append('<option selected="selected">' + v['AttackAlt'] + '</option>')
        });
        $("#cardName").SumoSelect({search: true, searchText: 'Enter here.'});
        $("#cardType,#cardRarity,#cardSet,#cardOrange,#cardBlue,#cardWhite,#cardStars,#cardAttackBot,#cardAttackAlt").SumoSelect({ selectAll: true });
        $("#cardProfession").SumoSelect();
			}).fail(function (jqXHR, textStatus){
        //console.log(jqXHR);
			}).always(function (jqXHR,textStatus){ 
        ajaxInProgress = false;
      });
    
  }
  getData();
  $("#cardType,#cardRarity,#cardProfession,#cardBlue,#cardOrange,#cardWhite").on('change',function(){
    console.log($("#cardType").val());
    var cardType = "",
        cardRarity = "",
        cardProfession = "",
		cardBlue = "",
		cardOrange = "",
		cardWhite = "",
        results = "";
    if ($("#cardType").val().length != $("#cardType")[0].length && $("#cardType").val().length > 0){
      cardType = 'and Type in (' + $("#cardType").val().map(i => `"${i}"`).join(",") + ')';
    }
    if ($("#cardRarity").val().length != $("#cardRarity")[0].length && $("#cardRarity").val().length > 0){
      cardRarity = 'and Rarity in (' + $("#cardRarity").val().map(i => `"${i}"`).join(",") + ')';
    }
    if ($("#cardProfession").val() != "Any"){
      cardProfession = ' and Profession like ("%' + $("#cardProfession").val() + '%")'
    }
	if ($("#cardBlue").val().length != $("#cardBlue")[0].length && $("#cardBlue").val().length > 0){
      cardBlue = 'and Blue in (' + $("#cardBlue").val().map(i => `"${i}"`).join(",") + ')';
    }
	if ($("#cardOrange").val().length != $("#cardOrange")[0].length && $("#cardOrange").val().length > 0){
      cardOrange = 'and Orange in (' + $("#cardOrange").val().map(i => `"${i}"`).join(",") + ')';
    }
	if ($("#cardWhite").val().length != $("#cardWhite")[0].length && $("#cardWhite").val().length > 0){
      cardWhite = 'and White in (' + $("#cardWhite").val().map(i => `"${i}"`).join(",") + ')';
    }
    console.log(cardProfession);
    var res = alasql("SELECT * FROM cards where 1=1 " + cardOrange + " " + cardWhite + " " + cardBlue + " " + cardProfession + " " + cardRarity + " " + cardType + " order by Name");
    //console.log(res);
    $(".card").hide();
    results = res.map(i => `#${i.ID}`).join(",");
    console.log(results);
    $(results).show();
  });
  $("#cards").on("mouseenter mouseleave", ".card", function(event){

    if (event.type === "mouseenter"){
      
      var item = $(this).data("card");
      if (item.Type == 'Character'){
        $("#cardDisplay").show().html("<img class='alt' src='" + item.Image + "' />");
      } else {
        $("#cardDisplay").show().html("<img src='" + item.Image + "' />");
      }
      
      //console.log(item.Name);
    }
    if (event.type === "mouseleave"){
				//$("#cardDisplay").hide();
		}
  });
  
  function displayQueryResults(items){
    var deck = "", comp = "";
    $.each(items, function(k,v){
      var displayName = "";
      if (v.Title != ""){
        displayName = v.Name + "<br />" + v.Title;
      } else {
        displayName = v.Name
      }
      $("#cards").append("<li class='card' id='" + v.ID + "'>"+ displayName + "</li>");
      //$("#"+v.ID).data("card") = v;
      $("#"+v.ID).data("card", v);
      deck += v.Identity;
    });
    comp = LZString.compress(deck);
    $("#compressed").text(comp);
  }
  
  function getJsonArrayFromData(data)
  {

    var obj = {};
    var result = [];
    var headers = data[0];
    var cols = headers.length;
    var row = [];

    for (var i = 1, l = data.length; i < l; i++)
    {
      // get a row to fill the object
      row = data[i];
      // clear object
      obj = {};
      for (var col = 0; col < cols; col++) 
      {
        // fill object with new values
        obj[headers[col]] = row[col];    
      }
      // add object in a final result
      result.push(obj);  
    }

    return result;  

  }
});
    </script>

</body>

</html>
 
